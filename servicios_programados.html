<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Avisos y llamadas</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Dashboard" name="description" />
    <meta content="Themesbrand" name="author" />
    <meta name="keywords" content="Dashboard, clientes, pedidos, potogas">
    <!-- App favicon -->
    <link rel="shortcut icon"
        href="https://5298967-sb1.app.netsuite.com/core/media/media.nl?id=108997&c=5298967_SB1&h=MqKO6RyzbmQKiMqwc6-9rA2wJSTQZ0yi96oPgnj9KQwozioR&_xt=.ico">

    <!-- Select 2 -->
    <link href="https://themesbrand.com/skote/layouts/assets/libs/select2/css/select2.min.css" rel="stylesheet"
        type="text/css" />

    <!-- Datepicker -->
    <link href="https://themesbrand.com/skote/layouts/assets/libs/bootstrap-datepicker/css/bootstrap-datepicker.min.css"
        rel="stylesheet" type="text/css">
    <link href="https://themesbrand.com/skote/layouts/assets/libs/@chenfengyuan/datepicker/datepicker.min.css"
        rel="stylesheet">

    <!-- Timepicker -->
    <link href="https://themesbrand.com/skote/layouts/assets/libs/bootstrap-timepicker/css/bootstrap-timepicker.min.css"
        rel="stylesheet" type="text/css">

    <!-- DataTables -->
    <link href="https://themesbrand.com/skote/layouts/assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css"
        rel="stylesheet" type="text/css" />
    <!-- <link href="./assets/libs/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css" />
    <link href="./assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css" />    -->

    <!-- <link rel="stylesheet" href="./assets/libs/@chenfengyuan/datepicker/datepicker.min.css"> -->

    <!-- Bootstrap Css -->
    <link href="https://themesbrand.com/skote/layouts/assets/css/bootstrap.min.css" id="bootstrap-style"
        rel="stylesheet" type="text/css" />
    <!-- Select 2 -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <!-- Icons Css -->
    <!-- <link href="https://themesbrand.com/skote/layouts/assets/css/icons.min.css" rel="stylesheet" type="text/css" /> -->
    <!-- App Css-->
    <link href="https://themesbrand.com/skote/layouts/assets/css/app.min.css" id="app-style" rel="stylesheet"
        type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
        integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        html,
        body {
            font-family: "Roboto", "Helvetica Neue", sans-serif !important;
        }

        .pl-0 {
            padding-left: 0;
        }

        .pr-0 {
            padding-right: 0;
        }

        .btn-flat {
            border-radius: 0;
        }

        .btn-header {
            width: 51px;
            height: 56px;
        }

        .bg-primary-cc {
            background-color: #355da7;
            color: #ffffff;
        }

        button.bg-primary-cc:hover {
            background-color: #456aae;
            color: #ffffff;
        }

        .bg-secondary-cc {
            background-color: #e7792b;
            color: #ffffff;
        }

        button.bg-secondary-cc:hover {
            background-color: #e98640;
            color: #ffffff;
        }

        .bg-success-cc {
            background-color: #2dd36f;
            color: #ffffff;
        }

        button.bg-success-cc:hover {
            background-color: #42d77d;
            color: #ffffff;
        }

        .bg-warning-cc {
            background-color: #ffc409;
            color: #ffffff;
        }

        button.bg-warning-cc:hover {
            background-color: #ffca22;
            color: #ffffff;
        }

        .bg-dark-cc {
            background-color: #222428;
            color: #ffffff;
        }

        button.bg-dark-cc:hover {
            background-color: #222428;
            color: #ffffff;
        }

        .bg-danger-cc {
            background-color: #eb445a;
            color: #ffffff;
        }

        button.bg-danger-cc:hover {
            background-color: #ed576b;
            color: #ffffff;
        }

        #header-title {
            font-size: 28px;
        }

        .ft-12 {
            font-size: 12px;
        }

        .ft-16 {
            font-size: 16px;
        }

        .bg-white {
            background-color: #ffffff;
        }

        .chip {
            display: inline-block;
            padding: 0 25px;
            height: 30px;
            font-size: 16px;
            line-height: 30px;
            border-radius: 25px;
            opacity: 0.8;
            cursor: pointer;
        }

        .chip.bg-primary-cc {
            background-color: rgba(231, 121, 43, 0.08)
        }

        .chip img {
            float: left;
            margin: 0 10px 0 -25px;
            height: 25px;
            width: 25px;
            margin-top: 2.5px;
            border-radius: 50%;
        }

        .w-100 {
            width: 100%;
        }

        .h-100 {
            height: calc(100vh - 56px);
        }

        .form-ptg {
            font-size: 16px;
            border: solid 2px #9d9b99;
            border-radius: 9px;
            padding-left: 9px;
            color: #737373;
            padding-right: 9px;
            width: 100%;
            padding-top: 9px;
            padding-bottom: 9px;
        }

        select.form-ptg {
            padding-top: 11.5px;
            padding-bottom: 11.5px;
        }

        .form-ptg-primary {
            border: solid 2px #355da7;
            color: #355da7;
        }

        .content-input-primary .form-ptg-primary[type="date"]::-webkit-calendar-picker-indicator {
            background: url(https://5298967-sb1.app.netsuite.com/core/media/media.nl?id=108994&c=5298967_SB1&h=TZdf2C4l2Y6fG6GOHYfluLN8kg0dvo3J-bUwrhd1rbdlhL_3) center/80% no-repeat;
            cursor: pointer;
        }

        .content-input-primary .form-ptg-primary[type="time"]::-webkit-calendar-picker-indicator {
            background: url(https://5298967-sb1.app.netsuite.com/core/media/media.nl?id=109002&c=5298967_SB1&h=8T8_xbgLaXGq57So_VQ-KoCwOPoyvxXLL-O9cpcfxC44F6Do) center/80% no-repeat;
            cursor: pointer;
        }

        .form-search {
            width: 100%;
            position: relative;
        }

        .p-rel {
            position: relative;
        }

        .form-search .form-ptg {
            padding-left: 45px;
            padding-right: 45px;
        }
        

        .form-search .fa-magnifying-glass {
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            margin: auto;
            height: 20px;
            font-size: 20px;
            cursor: text;
        }

        .form-search .fa-xmark {
            position: absolute;
            right: 15px;
            top: 0;
            bottom: 0;
            margin: auto;
            height: 20px;
            font-size: 20px;
            cursor: pointer;
        }

        .vertical-center {
            margin: auto;
            position: absolute;
            top: 0;
            right: 0;
            left: 0;
            bottom: 0;
            height: fit-content;
            width: fit-content;
        }

        label {
            margin: 0;
        }

        .fw-bold {
            font-weight: bold;
        }

        .content-tabs {
            background-color: rgb(225, 225, 225);
            ;
        }

        .content-tabs .tab {
            padding: 7px 20px;
            margin: 0px 0;
            cursor: pointer;
        }

        .tab.active {
            background: #ffffff;
            border-radius: 10px 0;
            color: #355da7;
        }

        .modal-header .modal-title {
            color: #ffffff;
        }

        .content-input label {
            color: #737373;
            margin-bottom: 5px;
            font-size: 16px;
            font-weight: bold;
        }

        .content-input-primary label {
            color: #355da7;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .color-primary {
            color: #355da7;
        }

        .ft-18 {
            font-size: 18px;
        }

        .invisible {
            visibility: hidden;
        }

        .ft-24 {
            font-size: 24px;
        }

        .table-gen {
            min-width: 100%;
        }

        .table-gen .sticky-col {
            position: -webkit-sticky;
            position: sticky;
            left: 0px;
        }

        .table-gen thead tr th {
            position: sticky;
            top: 0;
        }

        .table-gen thead tr th,
        .table-gen tbody tr td {
            padding-top: 10px;
            padding-bottom: 10px;
        }

        .table-gen-blue thead tr th {
            background: #355da7;
            color: #ffffff;
        }

        .table-gen-blue tbody tr:nth-of-type(odd) td {
            background-color: #ffffff;
        }

        .table-gen-blue tbody tr:nth-of-type(even) td {
            background-color: rgb(225, 225, 225);
        }

        .text-right {
            text-align: right;
        }

        .btn-expand {
            width: 60px;
            height: 60px;
            position: absolute;
            right: -30px;
            top: 0;
            bottom: 0;
            margin: auto;
        }

        .btn-expand-down {
            width: 60px;
            height: 60px;
            position: absolute;
            bottom: -30px;
            left: 0;
            right: 0;
            margin: auto;
        }

        .btn-expand .btn,
        .btn-expand-down .btn {
            width: 100%;
            height: 100%;
            background: #e7792b;
            border-radius: 100px;
            cursor: pointer;
            box-shadow: 5px 2px 20px 6px rgb(0 0 0);
            position: relative;
        }

        .btn-expand-down .btn {
            z-index: 2;
            position: relative;
        }

        .btn-expand .btn:hover,
        .btn-expand-down .btn:hover {
            background: #e98640;
        }

        .btn-expand .btn i {
            position: absolute;
            left: 0;
            right: 15px;
            bottom: 0;
            top: 0;
            margin: auto;
            height: 22px;
            font-size: 22px;
            color: #ffffff;
        }

        .btn-expand-down .btn i {
            position: absolute;
            left: 0;
            top: 5px;
            right: 0;
            left: 0;
            margin: auto;
            font-size: 22px;
            color: #ffffff;
        }

        .title-tab {
            font-size: 24px;
            font-weight: bold;
            color: #d4d4d4;
        }

        .title-tab.active {
            cursor: pointer;
            color: #000000;
        }

        .c-pointer {
            cursor: pointer;
        }

        .card {
            box-shadow: rgb(0 0 0 / 20%) 0px 3px 1px -2px, rgb(0 0 0 / 14%) 0px 2px 2px 0px, rgb(0 0 0 / 12%) 0px 1px 5px 0px;
        }

        .text-center {
            text-align: center;
        }

        .title-ptg {
            font-size: 24px;
        }

        .check-ptg {
            font-size: 20px;
        }

        /* no global ccs */
        #filters-data {
            background-color: rgb(225, 225, 225);
            position: relative;
        }
        #content-filters {
            background-color: rgb(225, 225, 225);
            height: 155px;
            overflow: auto;
            position: relative;
        }

        #content-casos {
            width: 100%;
            overflow: auto;
            background-color: white;
            height: calc(100vh - 312px);
            position: relative;
        }

        #content-casos.no-expand {
            height: calc(100vh - 157px);
        }

        #historic-data {
            overflow: auto;
            height: calc(100vh - 449px);
        }

        #content-forms {
            overflow: hidden;
            background-color: #ffffff;
        }

        .tabs-content {
            height: calc(100vh - 326px);
            overflow: auto;
            background-color: #ffffff;
            overflow-x: hidden;
        }

        .tabs-content.no-expand {
            height: calc(100vh - 122px);
        }

        #content-forms.no-expand .tabs-content {
            height: calc(100vh - 324px);
        }

        #content-avisos {
            height: calc(100vh - (100vh - 290px) - 56px);
        }

        .content-input .select2 {
            font-size: 16px;
            border: solid 2px #9d9b99;
            border-radius: 9px;
            padding-left: 9px;
            color: #737373;
            padding-bottom: 9px;
            padding: 2px 9px;
            background: white;
            width: 100% !important;
        }

        .content-input.content-input-primary .select2 {
            border: solid 2px #355da7;
            color: #355da7;
        }

        .content-input .select2 .select2-selection {
            border: 0;
        }

        .content-input .select2 .select2-selection .select2-selection__rendered {
            padding-left: 0;
        }

        .content-gen {
            border-radius: 20px;
            background-color: #efefef;
        }

        .content-gen .title {
            color: #000000;
            font-weight: bold;
        }

        .content-gen .resp {
            color: #000000;
            border-bottom: 1px solid #000000;
        }

        .dropdown-menu {
            width: 180px;
        }

        textarea {
            resize: none;
        }

        .border-bottom-primary {
            border-bottom: solid 2px #355da7;
        }

        input:disabled, textarea:disabled, select:disabled {
            background-color: #c9c9c9;
            cursor: not-allowed;
        }

        .tab {
            font-size: 20px;
            font-weight: bold;
            color: #ffffff;
            background-color:rgb(182, 182, 182);
            border: 2px solid rgb(182, 182, 182);
            padding-left: 15px;
            cursor: pointer;
        }

        .tab.active {
            cursor: unset;
            background-color: var(--color-primary);
        }

        .tab:first-child {
            border-radius: 10px 0 0 10px;
        }

        .tab:last-child {
            border-radius: 0 10px 10px 0;
        }

        #tablePedidos tfoot, #tableCasos tfoot {
            position: fixed;
            width: fit-content;
            margin: auto;
            left: 0;
            right: 0;
            bottom: 0;
        }
        #tablePedidos tfoot.expand, #tableCasos tfoot.expand {
            right: 50%;
        }
    </style>
</head>

<body data-topbar="dark" data-spy="scroll" data-offset="175" style="overflow: hidden;">
    <header class="bg-primary-cc">
        <div class="row align-items-center w-100">
            <!--<div class="col-auto pr-0">
                <button id="btnMenu" type="button" class="btn bg-primary-cc btn-flat btn-header"><i
                        class="fa-solid fa-bars"></i></button>
                <button id="btnBack" type="button" class="btn bg-primary-cc btn-flat btn-header d-none"><i
                        class="fa-solid fa-arrow-left"></i></button>
            </div>-->
            <div class="col-auto pr-0">
                <img src="https://5298967-sb1.app.netsuite.com/core/media/media.nl?id=108998&c=5298967_SB1&h=58fXy2zvwjIT_OA9h721BFfwCFF1pYHerADEgGg1wbWxKFPt"
                    alt="" height="56">
            </div>
            <div id="header-title" class="col">
                Avisos y llamadas
            </div>
            <div class="col-auto p-0">
                <div class="row align-items-center">
                    <div class="col-auto pr-0 ft-16" id="today">
                    </div>
                    <div class="col-auto pr-0 ft-16">
                        <strong>ROL: </strong><span id="role"></span>
                    </div>
                    <div class="col-auto pr-0 ft-16">
                        <strong>PLANTA: </strong>
                    </div>
                    <div class="col-auto pr-0 ft-16">
                        <select id="plantas" type="date" style="
                            width: 190px; 
                            height: 30px; 
                            background: #ffffff; 
                            border-width: 1px; 
                            border-color: #808080; 
                            color: #000;">
                        </select>
                    </div>
                    <div class="col-auto">
                        <div class="chip bg-primary-cc">
                            <img
                                src="https://5298967-sb1.app.netsuite.com/core/media/media.nl?id=108996&c=5298967_SB1&h=64w8opEXTYUI8Zk4V_YCr91jyFiSRorKvI31OBBt0vD9Su8V">
                            <span class="user-name"></span>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </header>

    <div id="formVerDetallesPedidos" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="titleerDetallesPedidosModal" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document" style="width: 600px;">
            <div class="modal-content " style="border: 0">
                <div class="modal-header">
                    <div class="row align-items-center">
                        <div class="col-auto">
                            <img src="https://5298967-sb1.app.netsuite.com/core/media/media.nl?id=110815&c=5298967_SB1&h=he-4rJolZ3J7WidhKv2oNWSuYY-s45IhArkF-ivqlvB7sd_A"
                            alt="" width="120">
                        </div>
                        <div class="col text-center">
                            <label class="fw-bold" style="font-size: 22px;" id="verDetallesCliente"></label><br>
                            <label class="fw-bold" style="font-size: 18px;" id="verDetallesTelefono"></label><br>
                            <label class="fw-bold" style="font-size: 16px;" id="verDetallesDireccion"></label><br>
                            <label class="fw-bold" style="font-size: 16px;">Tipo: <span id="verDetallesTipoServicio"></span></label>
                        </div>
                    </div>
                </div>
                <div class="modal-body">
                    <div class="content-gen">
                        <div class="row p-3">
                          <div class="col-3 title">Servicio</div>
                          <div id="verDetallesServicio" class="col-9 resp"></div>
                        </div>
                        <div class="row p-3">
                          <div class="col-3 title">Direccíon</div>
                          <div id="verDetallesDireccion2" class="col-9 resp"></div>
                        </div>
                        <div class="row p-3">
                          <div class="col-3 title">Fecha Prometida</div>
                          <div id="verDetallesFechaPrometida" class="col-9 resp"></div>
                        </div>
                        <div class="row p-3">
                          <div class="col-3 title">Tipo Producto</div>
                          <div id="verDetallesTipoProducto" class="col-9 resp"></div>
                        </div>
                        <div class="row p-3">
                            <div class="col-3 title">Estado de seguimiento</div>
                            <div id="verDetallesEstadoSeguimiento" class="col-9 resp"></div>
                        </div>
                        <div class="row p-3">
                            <div class="col-3 title">Observaciones</div>
                            <div id="verDetallesObservaciones" class="col-9 resp"></div>
                        </div>
                        <div class="row p-3">
                            <div class="col-12">
                                <div class="row">
                                    <div class="card-body p-0">
                                        <div class="col-12 d-none">
                                            <div class="table-responsive">
                                                <table class="table table-striped productosCilindroPedido m-0">
                                                    <thead style="color: #000;">
                                                        <tr>
                                                            <th scope="col">Producto</th>
                                                            <th scope="col" class="text-center">Cantidad</th>
                                                            <th scope="col" class="text-center">Capacidad</th>
                                                            <th scope="col" class="text-center">Valor</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                    </tbody>
                                                    <tfoot>
                                                        <tr>
                                                            <td colspan="3" style="text-align: right; font-weight: bold;">Total</td>
                                                            <td colspan="1" class="text-center total" data-total="">$0 mxn</td>
                                                        </tr>
                                                    </tfoot>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="col-12 d-none">
                                            <div class="table-responsive">
                                                <table class="table table-striped productosEstacionarioPedido">
                                                    <thead>
                                                        <tr>
                                                            <th scope="col">Producto</th>
                                                            <th scope="col" class="text-center">Litros</th>
                                                            <th scope="col" class="text-center">Cantidad</th>
                                                            <th scope="col" class="text-center">Total</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                    </tbody>
                                                    <tfoot>
                                                        <tr>
                                                            <td colspan="3" style="text-align: right; font-weight: bold;">Total</td>
                                                            <td colspan="1" class="text-center total" data-total="">$0 mxn</td>
                                                        </tr>
                                                    </tfoot>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="formReprogramarModal" class="modal fade" tabindex="-1" role="dialog"
        aria-labelledby="titleReprogramarModal" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document" style="width: 300px;">
            <div class="modal-content " style="border: 0">
                <div class="modal-header bg-primary-cc">
                    <h5 class="modal-title" id="titleReprogramarModal">Reprogramar servicio: <span id="reprogramarPedido"></span></h5>
                </div>
                <div class="modal-body">
                    <div class="content-input content-input-primary">
                        <label>Fecha prometida*</label>
                        <input id="fechaPrometidaReprogramar" type="date" class="form-ptg form-ptg-primary">
                    </div>
                    <div class="content-input content-input-primary">
                        <label>Desde*</label>
                        <input id="desdeReprogramar" type="time" class="form-ptg form-ptg-primary">
                    </div>
                    <div class="content-input content-input-primary">
                        <label>Hasta*</label>
                        <input id="hastaReprogramar" type="time" class="form-ptg form-ptg-primary">
                    </div>
                    <div class="content-input content-input-primary mt-3">
                        <label>Comentario</label><br>
                        <textarea rows="3" id="comentarioReprogramar" class="form-ptg form-ptg-primary"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                        aria-label="Close">Cancelar</button>
                    <button id="guardarReprogramar" type="button" class="btn btn-primary">Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="formCambiarEstadoModal" class="modal fade" tabindex="-1" role="dialog"
        aria-labelledby="titleCambiarEstadoModal" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document" style="width: 400px;">
            <div class="modal-content " style="border: 0">
                <div class="modal-header bg-primary-cc">
                    <h5 class="modal-title" id="titleCambiarEstadoModal">Cambiar estado del servicio: <span id="cambiarEstadoPedido"></span></h5>
                </div>
                <div class="modal-body">
                    <div class="content-input content-input-primary">
                        <label>Estado*</label><br>
                        <select id="estadoCambiarEstado" class="form-ptg form-ptg-primary">
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                        aria-label="Close">Cancelar</button>
                    <button id="guardarCambiarEstado" type="button" class="btn btn-primary">Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="formSeguimientoModal" class="modal fade" tabindex="-1" role="dialog"
        aria-labelledby="titleSeguimientoModal" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document" style="width: 600px;">
            <div class="modal-content " style="border: 0">
                <div class="modal-header bg-primary-cc">
                    <h5 class="modal-title" id="titleSeguimientoModal">Seguimiento del servicio: <span id="seguimientoPedido"></span></h5>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-12">
                            <label style="font-weight: bold;">Lista de comentarios</label><br>
                            <table class="table-gen table-gen-blue text-center" id="table-notas-seguimiento">
                                <thead>
                                    <tr>
                                        <th>Autor</th>
                                        <th>Fecha</th>
                                        <th>Contenido</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-12">
                            <div class="content-input content-input-primary">
                                <div class="row">
                                    <div class="col">
                                        <label>Nueva nota*</label>
                                    </div>
                                </div>
                                <textarea id="nuevaNotaSeguimiento" rows="3" placeholder="Nota..." class="form-ptg form-ptg-primary"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                        aria-label="Close">Cancelar</button>
                    <button id="guardarSeguimiento" type="button" class="btn btn-primary">Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="formNotasAdicionalesModal" class="modal fade" tabindex="-1" role="dialog"
        aria-labelledby="titleNotasAdicionalesModal" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document" style="width: 300px;">
            <div class="modal-content " style="border: 0">
                <div class="modal-header bg-primary-cc">
                    <h5 class="modal-title" id="titleNotasAdicionalesModal">Agregar nota</h5>
                </div>
                <div class="modal-body">
                    <textarea id="notaAdicional" rows="3" placeholder="Nota..."
                        class="form-ptg form-ptg-primary"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                        aria-label="Close">Cancelar</button>
                    <button id="guardarNotaAdicional" type="button" class="btn btn-primary">Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="home-view" class="w-100 m-0">
        <div id="filters-data" class="p-3">
            <div class="btn-expand-down">
                <div class="p-rel btn">
                    <i class="fa-solid fa-caret-up"></i>
                </div>
            </div>
            <div id="content-filters" class="row">
                <div class="col-auto pb-2 ">
                    <div class="content-input" style="min-width: 380px;">
                        <label>Ruta</label><br>
                        <select id="filterRuta" onchange="getServicios(this)" class="form-ptg">
                            
                        </select>
                    </div>
                </div>
                <div class="col-auto pb-2 ">
                    <div class="content-input" style="min-width: 300px;">
                        <label>Colonia</label><br>
                        <select id="filterZona" onchange="getServicios(this)" class="form-ptg">
                            
                        </select>
                    </div>
                </div>
                <div class="col-auto pb-2 ">
                    <div class="content-input">
                        <label>Tipo de Producto</label><br>
                        <select id="filterTipoProducto" onchange="setSelectRutas(true);" class="form-ptg" style="width: 180px;">
                        </select>
                    </div>
                </div>     
                <div class="col-auto pb-2 ">
                    <div class="content-input">
                        <label>Próxima llamada</label><br>
                        <input id="filterProximaLlamada" onchange="getServicios(this)" type="date" class="form-ptg"/>
                    </div>
                </div>        
            </div>
        </div>
        <div id="content-data">
            <div class="row m-0" style="width: 100vw;">
                <div class="col-12 p-0" style="z-index: 2; position: relative; height: fit-content;">
                    <div id="content-casos">     
                        <table id="tablePedidos" class="table-gen table-gen-blue tipo-pedido">
                            <thead>
                                <tr>
                                    <th style="min-width: 40px; z-index: 1; left: 0;" class="text-center sticky-col">
                                        <i class="fa-solid fa-arrow-rotate-right c-pointer" onclick="getServicios(this)"></i>
                                        <div style="position: absolute; right: 0; top: 0; height: 100%; width: 1px; background-color: #000;"></div>
                                    </th>
                                    <th style="min-width: 110px" class="text-center">No. Servicio</th>
                                    <th style="min-width: 95px" class="text-center">Id Cliente</th>
                                    <th style="min-width: 135px" class="text-center">Tipo seguimiento</th>
                                    <th style="min-width: 155px" class="text-center">Fecha Prometida</th>
                                    <th style="min-width: 265px" class="text-center">Nombre Cliente</th>
                                    <th style="min-width: 125px" class="text-center">Teléfono</th>
                                    <th style="min-width: 125px" class="text-center">Tipo de producto</th>
                                    <th style="min-width: 355px" class="text-center">Dirección</th>
                                    <th style="min-width: 300px" class="text-center">Observaciones</th>
                                </tr>
                            </thead>
                            <tbody>   
                                <tr>
                                    <td colspan="17" class="text-center fw-bold py-5">Sin pedidos encontrados</td>
                                </tr>                  
                            </tbody>
                        </table>
                    </div>  
                </div>
            </div>
        </div>
    </div>

    <!-- END layout-wrapper -->

    <!-- JAVASCRIPT -->
    <script src="https://themesbrand.com/skote/layouts/assets/libs/jquery/jquery.min.js"></script>
    <script src="https://themesbrand.com/skote/layouts/assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- <script src="assets/libs/simplebar/simplebar.min.js"></script> -->
    <!-- <script src="assets/libs/jquery.easing/jquery.easing.min.js"></script> -->

    <!-- Datatablets -->
    <script src="https://themesbrand.com/skote/layouts/assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
    <script
        src="https://themesbrand.com/skote/layouts/assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>

    <!-- Datepicker -->
    <script
        src="https://themesbrand.com/skote/layouts/assets/libs/bootstrap-datepicker/js/bootstrap-datepicker.min.js"></script>
    <script src="https://themesbrand.com/skote/layouts/assets/libs/@chenfengyuan/datepicker/datepicker.min.js"></script>

    <!-- Timepicker -->
    <script
        src="https://themesbrand.com/skote/layouts/assets/libs/bootstrap-timepicker/js/bootstrap-timepicker.min.js"></script>
    <!-- Select2 -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script
        src="https://themesbrand.com/skote/layouts/assets/libs/bootstrap-timepicker/js/bootstrap-timepicker.min.js"></script>
    <!-- Extra -->
    <script src="https://themesbrand.com/skote/layouts/assets/libs/metismenu/metisMenu.min.js"></script>
    <!-- <script src="https://themesbrand.com/skote/layouts/assets/libs/simplebar/simplebar.min.js"></script> -->
    <script src="https://themesbrand.com/skote/layouts/assets/libs/node-waves/waves.min.js"></script>

    <!-- <script src="assets/js/app.js"></script> -->
    <script src="https://themesbrand.com/skote/layouts/assets/js/app.js"></script>

    <!-- Sweet alert -->
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

    <!-- Moment js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"
        integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- FancyTable -->
    <script src="https://cdn.jsdelivr.net/npm/jquery.fancytable/dist/fancyTable.min.js"></script>

    <!-- Funciones generales -->
    <script type="text/javascript">
        userName = '${ds.userName}';
        userRole = '${ds.userRole}';
        urlPlantas = '${ds.getPlantas}';
        urlRutas = '${ds.getListRoutes}';
        urlStatusOp = '${ds.getListStatusOpp}';
        urlTiposServicios = '${ds.getListTypeServices}';
        urlGetZone = '${ds.getZone}';
        urlGetListTypeContact = '${ds.getListTypeContact}';
        urlGetOpp = '${ds.getOppMonitor}';
        urlGetItemsOpp = '${ds.getItemsOpp}';
        urPutOppMonitor = '${ds.putOppMonitor}';
        urlPostNoteandMessage = "${ds.postNoteandMessage}";
        urlGetMessageandNotes = '${ds.getMessageandNotes}';
        urlGetNotesOfOPP = '${ds.getNotesOfOPP}';
        statusOP = [];
        countServices = 0;
        deftEstacionarVal = "4088";

        // Se inyecta la información del usuario logueado
        $('.user-name').text(userName);
        $('#role').text(userRole);
        $("#filterProximaLlamada").val(dateFormatFromDate(new Date(), "2"));

        $('body').delegate('.dropdown-toggle', 'show.bs.dropdown', function () {
            $(this).closest("td").css("z-index", "2");
        });

        $('body').delegate('.dropdown-toggle', 'hidden.bs.dropdown', function () {
            $(this).closest("td").css("z-index", "1");
        });

        // Call a global ajax method
        function setAjax(settings) {
            // Generamos el AJAX dinamico para las peticiones relacionadas con peddos
            return new Promise((resolve, reject) => {
                $.ajax({
                    url: settings.url,
                    method: settings.method,
                    data: settings.data ?? null,
                    // data: JSON.stringify(data),
                    contentType: 'application/json',
                    dataType: 'json',
                    success: function (response) {
                        if ( response.success ) {
                            resolve(response);
                        } else {
                            reject(response);
                            swal.close();
                            msg = response.msg ? response.msg : 'La petición no devolvió datos';
                            console.log('info', msg);
                            // infoMsg('info', msg);
                        }
                    }, error: function (xhr, status, error) {
                        console.error('mensaje de error');
                        reject({ xhr: xhr, status: status, error: error });
                    }
                });
            });
        }

        function dynamicSort(property) {
            var sortOrder = 1;
            if (property[0] === "-") {
                sortOrder = -1;
                property = property.substr(1);
            }
            return function (a, b) {
                /* next line works with strings and numbers, 
                * and you may want to customize it to your needs
                */
                var result = (a[property] < b[property]) ? -1 : (a[property] > b[property]) ? 1 : 0;
                return result * sortOrder;
            }
        }

        function dateFormatFromDate(date, format = "1") {
            if (typeof date == "string") {
                let aux = date;
                if(aux.split("-").length > 1) {
                    date = new Date(parseInt(aux.split("-")[0]), parseInt(aux.split("-")[1]) - 1, parseInt(aux.split("-")[2]));
                } else {
                    date = new Date(parseInt(aux.split("/")[2]), parseInt(aux.split("/")[1]) - 1, parseInt(aux.split("/")[0]));
                }                
            }

            let day = date.getDate();
            let month = date.getMonth();
            let year = date.getFullYear();
            let fecha = "";
            let months = ["Enero", "Febrero", "Marzo", "Abrrl", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
            if (format == "1") {
                fecha = day + " de " + months[month] + " - " + timeFormatFromDate(date);
            } else if (format == "2") {
                if (day < 10) {
                    day = "0" + day;
                }
                month = month + 1;
                if (month < 10) {
                    month = "0" + month;
                }
                fecha = year + "-" + month + "-" + day;
            } else if (format == "3") {
                fecha = day + "/" + month + "/" + year + " " + timeFormatFromDate(date);
            } else if (format == "4") {
                if (day < 10) {
                    day = "0" + day;
                }
                month = month + 1;
                if (month < 10) {
                    month = "0" + month;
                }
                fecha = year + "-" + month + "-" + day + "T" + timeFormatFromDate(date, "2");
            } else if (format == "5") {
                if (day < 10) {
                    day = "0" + day;
                }
                month = month + 1;
                if (month < 10) {
                    month = "0" + month;
                }
                fecha = day + "/" + month + "/" + year;
            } else if (format == "6") {
                if (day < 10) {
                    day = "0" + day;
                }
                month = month + 1;
                if (month < 10) {
                    month = "0" + month;
                }
                fecha = day + "-" + month + "-" + year;
            } else if (format == "7") {
                if (day < 10) {
                    day = "0" + day;
                }
                month = month + 1;
                if (month < 10) {
                    month = "0" + month;
                }
                fecha = day + "/" + month + "/" + year + " " + timeFormatFromDate(date);;
            }

            return fecha;
        }

        function timeFormatFromDate(date, format = "1") {
            date = new Date(date);
            let hours = date.getHours();
            let minutes = date.getMinutes();
            let seconds = date.getSeconds();
            let period = hours < 12 ? 'a.m.' : 'p.m.';
            if (minutes < 10) {
                minutes = "0" + minutes;
            }
            if (seconds < 10) {
                seconds = "0" + seconds;
            }
            let hora = "";
            if (format == "1") {
                hours = (hours + 24) % 12 || 12;
                if (hours < 10) {
                    hours = "0" + hours;
                }

                hora = hours + ":" + minutes + " " + period;
            } else if (format == "2") {
                if (hours < 10) {
                    hours = "0" + hours;
                }

                hora = hours + ":" + minutes;
            } else if (format == "3") {
                if (hours < 10) {
                    hours = "0" + hours;
                }

                hora = hours + ":" + minutes + ":" + seconds;
            }
            return hora;
        }

        function loadMsg(msg = 'Espere un momento porfavor...') {
    
            let swalObj = {
                title: msg,
                buttons: false,
                closeOnEsc: false,
                closeOnClickOutside: false,
                content: {
                    element: "div",
                    attributes: {
                        innerHTML:"<i class='fa-solid fa-spinner fa-spin fa-2x'></i>"
                    },
                }
            };

            swal(swalObj).catch(swal.noop);

        }

        function getZonas() {
            let dataZonas = {
                "requestType" : 'getZonas'
            };

            let settings = {
                url      : urlGetZone,
                method   : 'GET',
                data     : JSON.stringify(dataZonas),
            }

            $('#filterZona').children('option').remove();
            $("#filterZona").append(
                '<option value="0">Todas</option>'
            );
            setAjax(settings).then((response) => {
                
                if (response.success && response.data.length ) {
                    for ( var key in response.data ) {
                        if ( response.data.hasOwnProperty( key )) {
                            $("#filterZona").append(
                                '<option value="'+response.data[key].id+'">'+response.data[key].nombre+'</option>'
                            );
                        }
                    }
                    readyInit();
                } else {
                    console.warn('No hay zonas por cargar');
                    readyInit();
                }
                $('#filterZona').select2({
                    selectOnClose: true,
                    placeholder: "Seleccione una zona",
                    language: {
                        "noResults": function(){
                            return "Sin resultados encontrados";
                        }
                    }
                });
            }).catch((error) => {
                $('#filterZona').select2({
                    selectOnClose: true,
                    placeholder: "Seleccione una zona",
                    language: {
                        "noResults": function(){
                            return "Sin resultados encontrados";
                        }
                    }
                });
                console.log(error);
                readyInit();
            });
        }

        // Función para obtener las plantas
        function getPlantas() {
            let dataPlantas = {
                "requestType" : 'getPlantas'
            };

            let settings = {
                url      : urlPlantas,
                method   : 'GET',
                data     : JSON.stringify(dataPlantas),
            }

            setAjax(settings).then((response) => {
                setSelectPlants((response.data));
            }).catch((error) => {
                console.log(error);
            });
        }

        // Método para llenar el select de plantas
        function setSelectPlants(items) {
            if ( items.length ) {
                $('select#plantas').children('option').remove();
                for ( var key in items ) {
                    if ( items.hasOwnProperty( key ) ) {
                        $("select#plantas").append(
                            '<option value='+items[key].id+'>'+items[key].nombre+'</option>'
                        );
                    }
                }
                getRutas();
            } else {
                console.warn('No hay plantas por cargar');
            }
        }

        function getStatusOportunidad() {
            let settings = {
                url      : urlStatusOp,
                method   : 'GET'
            }

            setAjax(settings).then((response) => {
                setSelectStatusOp((response.data));
            }).catch((error) => {
                console.log(error);
            });
        }

        $("#notasAdicionalesSeguimiento").click(function () {
            $("#formNotasAdicionalesModal").modal("show");
            $("#notaAdicional").val("");
        });

        $("#guardarSeguimiento").click(function() {
            let pedido = $("#formSeguimientoModal").data("item");
            if($("#nuevaNotaSeguimiento").val() && $("#nuevaNotaSeguimiento").val().trim()) {
                confirmMsg("warning", "¿Seguro que desea guardar el seguimiento?", function(resp) {
                    if(resp) {
                        loadMsg();
                        let nota = [{ 
                            type: "nota", 
                            idRelacionado: pedido.no_pedido, 
                            titulo: "Nota - Avisos y llamadas (seguimiento)", 
                            nota: $("#nuevaNotaSeguimiento").val().trim(),
                            transaccion: "oportunidad"
                        }];
                        let settings2 = {
                            url      : urlPostNoteandMessage,
                            method   : 'POST',
                            data: JSON.stringify({ informacion: nota })
                        }
                        setAjax(settings2).then((response) => {
                            if(response.success) {
                                swal.close();
                                infoMsg('success', '', "Seguimiento guardado de manera correcta", null, function(resp) {
                                    $("#formSeguimientoModal").modal('hide');
                                    getServicios();
                                }); 
                            } else {
                                infoMsg('error', 'Error:', "Ocurrio un error al tratar de guardar el seguimiento");
                                swal.close();
                            }
                        }).catch((error) => {
                            infoMsg('error', 'Error:', "Ocurrio un error al tratar de guardar el seguimiento");
                            swal.close();
                        });
                    }
                });
            } else {
                let aux = "<ul>";
                if(!$("#nuevaNotaSeguimiento").val() || !$("#nuevaNotaSeguimiento").val().trim()) {
                    aux += "<li>Nueva nota</li>";
                }
                aux += "</ul>";
                infoMsg('warning', 'Campos requeridos:', aux);
            }
        });

        vrStatus = [];
        // Método para llenar el select de los estado de la oportunidad
        function setSelectStatusOp(items) {
            vrStatus = [];
            if ( items.length ) {
                $('#estadoCambiarEstado').children('option').remove();
                for ( var key in items ) {
                    vrStatus.push(items[key]);
                    if ( items.hasOwnProperty( key ) && items[key].id != "2" && items[key].id != "3" && items[key].id != "6") {
                        $("#estadoCambiarEstado").append(
                            '<option value="'+items[key].id+'">'+items[key].nombre+'</option>'
                        );
                    }
                }
                $('#estadoCambiarEstado').select2({
                    selectOnClose: true,
                    placeholder: "Seleccione un estado",
                    dropdownParent: $('#formCambiarEstadoModal'),
                    language: {
                        "noResults": function(){
                            return "Sin resultados encontrados";
                        }
                    }
                });
                readyInit();
            } else {
                console.warn('No hay estados de solicitud por cargar');
                readyInit();
            }
        }

        function getRutas(getPedidos = false) {
            if(getPedidos) {
                loadMsg();
            }
            let settings = {
                url      : urlRutas,
                method   : 'POST',
                data: JSON.stringify({
                    namePlanta : $("#plantas option:selected").text()
                })
            }

            setAjax(settings).then((response) => {
                if(response.success) {
                    rutasCilindros = response.rutaCilindro;
                    rutasEstacionarios = response.rutaEstacionario;
                    setSelectRutas(getPedidos);
                }        
            }).catch((error) => {
                console.log(error);
            });
        }

        $(".btn-expand-down").click(function () {
            if ($(this).find("i").hasClass('fa-caret-down')) {
                $(this).find(".btn").html('<i class="fa-solid fa-caret-up"></i>');
                $("#content-filters").removeClass("d-none");
                $("#content-casos").removeClass("no-expand");
                $(".tabs-content").removeClass("no-expand");
            } else {
                $(this).find(".btn").html('<i class="fa-solid fa-caret-down"></i>');
                $("#content-filters").addClass("d-none");
                $("#content-casos").addClass("no-expand");
                $(".tabs-content").addClass("no-expand");
            }
        });

        function setSelectRutas(getPedidos = false) {
            $('#filterRuta').parent().parent().removeClass("d-none");
            $('#filterRuta').children('option').remove();    
            if ( rutasCilindros.length || rutasEstacionarios.length) {        
                if($("#filterTipoProducto").val() == "0" || $("#filterTipoProducto").val() == "1") {
                    rutasCilindros.forEach(element => {
                        $("#filterRuta").append(
                            '<option value="'+element.internalId+'">'+element.name+'</option>'
                        );
                    });
                }
                if($("#filterTipoProducto").val() == "0" || $("#filterTipoProducto").val() == "2") {
                    rutasEstacionarios.forEach(element => {
                        $("#filterRuta").append(
                            '<option value="'+element.internalId+'">'+element.name+'</option>'
                        );
                    });
                }
                if($("#filterTipoProducto").val() == "3") {
                    $('#filterRuta').parent().parent().addClass("d-none");
                }
                $('#filterRuta').select2({
                    selectOnClose: true,
                    placeholder: "Seleccione una opción",
                    language: {
                        "noResults": function(){
                            return "Sin resultados encontrados";
                        }
                    }
                });
                if(getPedidos) {
                    getServicios(this);
                }        
                readyInit();
            } else {
                console.warn('No hay rutas por cargar');
                readyInit();
            }
        }

        $("#plantas").change(function() {
            getRutas(true);
        });

        // Función para obtener los tipos de servicios
        function getTiposServicios() {
            let settings = {
                url      : urlTiposServicios,
                method   : 'GET'
            }

            setAjax(settings).then((response) => {
                setSelectTiposServicios((response.data));
            }).catch((error) => {
                console.log(error);
            });
        }
        vrTiposServicios = [];
        // Método para llenar el select de los estado de la oportunidad
        function setSelectTiposServicios(items) {
            vrTiposServicios = [];
            if ( items.length ) {
                $('#filterTipoProducto').children('option').remove();
                for ( var key in items ) {
                    vrTiposServicios.push(items[key]);
                    if ( items.hasOwnProperty( key ) && items[key].id != "3" && items[key].id != "4") {
                        $("#filterTipoProducto").append(
                            '<option value="'+items[key].id+'">'+items[key].nombre+'</option>'
                        );
                    }
                }
                readyInit();
            } else {
                console.warn('No hay estados de solicitud por cargar');
                readyInit();
            }
        }

        function getFiltPedidos() {
            let filt = {};

            if($("#filterRuta").val()) {
                //filt.ruta = $("#filterRuta").val();
            }

            if($("#filterZona").val() != "0") {
                filt.colonia = "14" //$("#filterZona").val();
            }

            filt.tipo_producto = parseInt($("#filterTipoProducto").val());

            vrStatus.forEach(element => {
                if(element.nombre.toLowerCase() == "por confirmar") {
                    filt.status_oportunidad = element.id;
                }
            });

            filt.fechaPrometida1 = "24/03/2022"//dateFormatFromDate($("#filterProximaLlamada").val(), "5");
            filt.fechaPrometida2 = "24/03/2022"//dateFormatFromDate($("#filterProximaLlamada").val(), "5");

            return filt;
        }

        $("#guardarNotaAdicional").click(function () {
            if ($("#notaAdicional").val().trim()) {
                $("#notasAdicionales tbody").append(
                    '<tr class="notasAdicionalesItem">' +
                        '<td class="p-2">' +
                            $("#notaAdicional").val().trim() +
                        '</td>' +
                        '<td width="50" style="text-align: center;">' +
                            '<i class="fa-solid fa-trash-can" style="cursor: pointer;" onclick="deleteNota(this)"></i>' +
                        '</td>' +
                    '</tr>'
                );
                $("#formNotasAdicionalesModal").modal("hide");
            } else {
                alert("Llena la nota.");
            }

        });

        function deleteNota(item) {
            $(item).parent().parent().remove();
        }

        function removeDuplicates(originalArray, prop) {
            var newArray = [];
            var lookupObject = {};

            for (var i in originalArray) {
            lookupObject[originalArray[i][prop]] = originalArray[i];
            }

            for (i in lookupObject) {
            newArray.push(lookupObject[i]);
            }
            return newArray;
        }

        function initTable(table) {
            $("#"+table).fancyTable({
                sortColumn:0,
                pagination: true,
                perPage: 10,
                searchable:false,
                sortable: false
            });
        }

        function dateFormatFromString(datetime, format = "1") {
            if (format == "1") {
                let date = datetime.split(" ")[0].split("-");
                let time = [0, 0, 0]
                if (datetime.split(" ").length > 1) {
                    time = datetime.split(" ")[1].split(":");
                    if (datetime.split(" ")[2] == "PM") {
                        time[0] = parseInt(time[0]) + 12;
                    }
                }
                
                return new Date(date[0], parseInt(date[1]) - 1, date[2], time[0], time[1]);
            } else if (format == "2") {
                let date = datetime.split(" ")[0].split("/");
                let time = [0, 0];
                if (datetime.split(" ").length > 1) {
                    time = datetime.split(" ")[1].split(":");
                    if (datetime.split(" ")[2] == "PM") {
                        time[0] = parseInt(time[0]) + 12;
                    }
                }
                return new Date(date[2], parseInt(date[1]) - 1, date[0], time[0], time[1]);
            }
        }

        function getTimeFromString(time) {
            let aux = time.split(" "),
            aux2 = aux[0].split(":");
            if (aux.length > 1 && (aux[1].toLowerCase() == "pm" || aux[1].toLowerCase() == "p.m")) {
                if(parseInt(aux2[0]) < 12) {
                    aux2[0] = parseInt(aux2[0]) + 12;
                }                
            } else {
                if(aux2[0].toString().length == 1) {
                    aux2[0] = "0"+aux2[0].toString();
                }
                if(parseInt(aux2[0]) == 12) {
                    aux2[0] = "00";
                }
            }

            return aux2[0].toString() + ":" + aux2[1];

        }

        function getServicios() {
            let settings = {
                url      : urlGetOpp,
                method   : 'POST',
                data: JSON.stringify(getFiltPedidos())
            }
            if(!swal.getState().isOpen) {
                loadMsg();
            }
            
            $("#tablePedidos tbody").children("tr").remove();
            setAjax(settings).then((response) => {   
                console.log(response);     
                if(response.success) {
                    response.data = removeDuplicates(response.data, 'no_pedido');
                    if(response.data.length == 0) {
                        $("#tablePedidos tbody").append('<tr><td colspan="10" class="text-center fw-bold py-5">Sin pedidos encontrados</td></tr>');
                        initTable("tablePedidos");
                    }
                    
                    response.data.forEach((pedido, position) => {
                        if(pedido.fecha_prometida) {
                            pedido.fecha_hora_prometida = dateFormatFromString(pedido.fecha_prometida, "2");
                            pedido.fecha_prometida = dateFormatFromDate(new Date(pedido.fecha_prometida.split("/")[2], parseInt(pedido.fecha_prometida.split("/")[1]) - 1, pedido.fecha_prometida.split("/")[0]), "2");
                        }
                
                        if(pedido.fecha_solicitud) {
                            pedido.fecha_solicitud = dateFormatFromDate(new Date(pedido.fecha_solicitud.split("/")[2], parseInt(pedido.fecha_solicitud.split("/")[1]) - 1, pedido.fecha_solicitud.split("/")[0]), "2");
                        }
                                    
                        if(pedido.fecha_notificacion) {
                            pedido.fecha_hora_notificacion = dateFormatFromString(pedido.fecha_notificacion+(pedido.hora_notificacion ? " "+pedido.hora_notificacion : ''), "2");
                            pedido.fecha_notificacion = dateFormatFromDate(new Date(pedido.fecha_notificacion.split("/")[2], parseInt(pedido.fecha_notificacion.split("/")[1]) - 1, pedido.fecha_notificacion.split("/")[0]), "2");
                        }
                        vrStatus.forEach(element2 => {
                            if(element2.id == pedido.status_id) {
                                pedido.estado = element2.nombre;
                            }
                        });
                        if(pedido.desde) {
                            pedido.desde = getTimeFromString(pedido.desde);
                        }
                        if(pedido.hasta) {
                            pedido.hasta = getTimeFromString(pedido.hasta);
                        }
                    });
                    
                    $("#tablePedidos thead tr th").css('z-index', "3");
                    $($("#tablePedidos thead tr th")[0]).css('z-index', "4");
                    
                    response.data.forEach((pedido, position) => {
                        let tipoServicio = "";
                        vrTiposServicios.forEach(element => {
                            if(pedido.servicio == element.id) {
                                tipoServicio = element.nombre;
                            }
                        });
                        let trAux = '<tr data-item='+"'"+JSON.stringify(pedido)+"'"+'>'+
                                        '<td class="text-center sticky-col">'+  
                                            '<div class="btn-group dropend vertical-center">'+                                            
                                                '<i class="fa-solid fa-ellipsis-vertical c-pointer dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" style="font-size: 24px;"></i>'+
                                                '<ul class="dropdown-menu" style="width: max-content;">'+
                                                    '<li onclick="verDetalles(this)" class="px-2 py-1 c-pointer" style="font-size: 16px"><i class="fa-solid fa-eye color-primary"></i> Ver detalles</li>'+
                                                    '<li onclick="reprogramarServicio(this)" class="px-2 py-1 c-pointer" style="font-size: 16px"><i class="fa-regular fa-calendar-days color-primary"></i> Reprogramar servicio</li>'+
                                                    '<li onclick="cambiarEstadoServicio(this)" class="px-2 py-1 c-pointer" style="font-size: 16px"><i class="fa-solid fa-arrows-rotate color-primary"></i> Cambiar estado</li>'+
                                                    '<li onclick="seguimientoPedido(this)" class="px-2 py-1 c-pointer" style="font-size: 16px"><i class="fa-solid fa-comment-dots color-primary"></i> Seguimiento</li>'+
                                                '</ul>'+
                                            '</div>'+
                                            '<div style="position: absolute; right: 0; top: 0; height: 100%; width: 1px; background-color: #000;"></div>'+
                                        '</td>'+
                                        '<td class="text-center">' + pedido.no_pedido + '</td>'+
                                        '<td class="text-center">' + pedido.id_cliente + '</td>'+
                                        '<td class="text-center">Aviso</td>'+
                                        '<td class="text-center">' + dateFormatFromDate(pedido.fecha_prometida, '5') + '</td>'+
                                        '<td class="text-center">' + (pedido.nombre_cliente ? pedido.nombre_cliente : 'Sin nombre de cliente') + '</td>'+
                                        '<td class="text-center">' + (pedido.telefono ? pedido.telefono : 'Sin teléfono') + '</td>'+
                                        '<td class="text-center">' + tipoServicio + '</td>'+
                                        '<td class="text-center">' + (pedido.direccion ? pedido.direccion : 'Sin dirección') + '</td>'+
                                        '<td class="text-center">' + (pedido.observaciones ? pedido.observaciones : 'Sin observaciones') + '</td>'+
                                    '</tr>';
                                    
                        $("#tablePedidos tbody").append(trAux);

                        if(response.data.length == (position + 1)) {
                            initTable("tablePedidos");
                        }
                    });
                    swal.close();
                } else {
                    $("#tablePedidos tbody").append('<tr><td colspan="10" class="text-center fw-bold py-5">Sin pedidos encontrados</td></tr>');
                    swal.close();
                }
            }).catch((error) => {
                console.log(error);
                $("#tablePedidos tbody").append('<tr><td colspan="10" class="text-center fw-bold py-5">Sin pedidos encontrados</td></tr>');
                swal.close();
            });
        }

        function cambiarEstadoServicio($this) {
            let servicio = $($this).closest("tr").data("item");
            $("#cambiarEstadoPedido").html(servicio.no_pedido ? servicio.no_pedido : '');
            $("#estadoCambiarEstado").val(null).trigger("change");;
            $("#formCambiarEstadoModal").data("item", servicio);
            $("#formCambiarEstadoModal").modal("show");
        }

        function seguimientoPedido($this) {
            let pedido = $($this).closest("tr").data("item");
            $("#seguimientoPedido").html(pedido.no_pedido ? pedido.no_pedido : '');
            let settings = {
                url      : urlGetNotesOfOPP,
                method   : 'POST',
                data     : JSON.stringify({opp : pedido.no_pedido}),
            }
            $("#nuevaNotaSeguimiento").val("");
            $("#sendSmsSeguimiento").prop("checked", true);
            $("#table-notas-seguimiento tbody").children("tr").remove();
            $("#table-notas-seguimiento tbody").append('<tr>' +
                                                            '<td colspan="3" class="text-center">' +
                                                                'Sin comentarios'+
                                                            '</td>' +
                                                        '</tr>');
            
            setAjax(settings).then((response) => {
                if(response.success) {
                    if(response.data.length > 0) {
                        $("#table-notas-seguimiento tbody").children("tr").remove();
                    }
                    response.data.forEach(element => {
                        if(element.note && element.note.trim()) {
                            let trAux = '<tr>' +
                                            '<td class="ion-text-center sticky-col fw-bold">'+element.author+'</td>'+
                                            '<td class="ion-text-center sticky-col fw-bold">'+element.date+'</td>'+
                                            '<td class="ion-text-center sticky-col fw-bold">'+element.note+'</td>'+
                                        '</tr>';
                            $("#table-notas-seguimiento tbody").append(trAux);
                        }
                        
                    });
                    $("#formSeguimientoModal").data("item", pedido);
                    $("#formSeguimientoModal").modal("show");
                }
            }).catch((error) => {
                console.log(error);
            });
        }

        function reprogramarServicio($this) {
            let servicio = $($this).closest("tr").data("item");
            $("#reprogramarPedido").html(servicio.no_pedido ? servicio.no_pedido : '');
            $("#fechaPrometidaReprogramar").val(dateFormatFromDate(servicio.fecha_prometida, "2"));
            $("#desdeReprogramar").val(servicio.desde ? getTimeFromString(servicio.desde) : null);
            $("#hastaReprogramar").val(servicio.hasta ? getTimeFromString(servicio.hasta) : null);
            $("#comentarioReprogramar").val("");
            $("#formReprogramarModal").data("item", servicio);
            $("#formReprogramarModal").modal("show");
        }

        $("#guardarReprogramar").click(function() {
            let servicio = $("#formReprogramarModal").data("item");
            if(!$("#fechaPrometidaReprogramar").val() ||
            !$("#desdeReprogramar").val() ||
            !$("#hastaReprogramar").val()) {
                let aux = "<ul>";
                if(!$("#fechaPrometidaReprogramar").val()) {
                    aux += "<li>Fecha prometida</li>";
                }
                if(!$("#desdeReprogramar").val()) {
                    aux += "<li>Desde</li>";
                }
                if(!$("#hastaReprogramar").val()) {
                    aux += "<li>Hasta</li>";
                }
                aux += "</ul>";
                infoMsg('warning', 'Campos requeridos:', aux);
                return;
            }
            confirmMsg("warning", "¿Seguro que desea reprogramar el servicio?", function(resp) {
                if(resp) {
                    let dataSend = {
                        "opportunitiesUpdate": [
                            {
                                "id": servicio.no_pedido,
                                "bodyFields": {
                                    "expectedclosedate": dateFormatFromDate($("#fechaPrometidaReprogramar").val(), "5"),
                                    "custbody_ptg_entre_las": formatTime( $('#desdeReprogramar').val() ),
                                    "custbody_ptg_y_las" : formatTime( $('#hastaReprogramar').val())
                                },
                                "lines": [
                                    
                                ]
                            }
                        ]
                    };
                    loadMsg();
                    let settings = {
                        url      : urPutOppMonitor,
                        method   : 'PUT',
                        data: JSON.stringify(dataSend)
                    }
                    setAjax(settings).then((response) => {
                        if(response.success) {
                            if($("#comentarioReprogramar").val().trim()) {
                                let nota = [{ 
                                    type: "nota", 
                                    idRelacionado: servicio.no_pedido, 
                                    titulo: "Reprogramación de servicio", 
                                    nota: $("#comentarioReprogramar").val().trim(),
                                    transaccion: "oportunidad"
                                }];
                                let settings2 = {
                                    url      : urlPostNoteandMessage,
                                    method   : 'POST',
                                    data: JSON.stringify({ informacion: nota })
                                }
                                setAjax(settings2).then((response) => {
                                    if(response.success) {
                                        $("#formReprogramarModal").modal("hide");
                                        swal.close();
                                        infoMsg('success', '', "Servicio reprogramado de manera correcta", null, function(resp) {
                                            getServicios();
                                        }); 
                                    }
                                }).catch((error) => {
                                    $("#formReprogramarModal").modal("hide");
                                    swal.close();
                                    infoMsg('success', '', "Servicio reprogramado de manera correcta", null, function(resp) {
                                        getServicios();
                                    }); 
                                });
                            } else {
                                $("#formReprogramarModal").modal("hide");
                                swal.close();
                                infoMsg('success', '', "Servicio reprogramado de manera correcta", null, function(resp) {
                                    getServicios();
                                }); 
                            }                                                         
                        } else {
                            swal.close();
                            infoMsg('error', 'Error:', "Ocurrio un error al tratar de reprogramar el servicio");
                        }            
                    }).catch((error) => {
                        infoMsg('error', 'Error:', "Ocurrio un error al tratar de reprogramar el servicio");
                        console.log(error);
                        swal.close();
                    });
                }
            });
        });

        $("#guardarCambiarEstado").click(function() {
            let servicio = $("#formCambiarEstadoModal").data("item");
            if(!$("#estadoCambiarEstado").val()) {
                let aux = "<ul>";
                if(!$("#estadoCambiarEstado").val()) {
                    aux += "<li>Estado</li>";
                }
                aux += "</ul>";
                infoMsg('warning', 'Campos requeridos:', aux);
                return;
            }
            confirmMsg("warning", "¿Seguro que desea cambiar el estado del servicio?", function(resp) {
                if(resp) {
                    let dataSend = {
                        "opportunitiesUpdate": [
                            {
                                "id": servicio.no_pedido,
                                "bodyFields": {
                                    "custbody_ptg_estado_pedido": $("#estadoCambiarEstado").val(),
                                },
                                "lines": [
                                    
                                ]
                            }
                        ]
                    };
                    loadMsg();
                    let settings = {
                        url      : urPutOppMonitor,
                        method   : 'PUT',
                        data: JSON.stringify(dataSend)
                    }
                    setAjax(settings).then((response) => {
                        if(response.success) {
                            $("#formCambiarEstadoModal").modal("hide");
                            swal.close();
                            infoMsg('success', '', "Cambio de estado de manera correcta", null, function(resp) {
                                getServicios();
                            });                                                  
                        } else {
                            swal.close();
                            infoMsg('error', 'Error:', "Ocurrio un error al tratar de reprogramar el servicio");
                        }            
                    }).catch((error) => {
                        infoMsg('error', 'Error:', "Ocurrio un error al tratar de reprogramar el servicio");
                        console.log(error);
                        swal.close();
                    });
                }
            });
        });

        function formatTime(value, format = 'hh:mm a') {
            let hora = value.split(':');
            let customDateTime = new Date();

            if ( hora.length ) {

                customDateTime.setHours(hora[0]);
                customDateTime.setMinutes(hora[1]);

                return moment(customDateTime).format(format);

            } 

            return '';
        }

        function confirmMsg(type, title, callback) {

            let swalObj = {
                title: title,
                icon: type ?? 'info',
                buttons:["Cancelar", "Aceptar"],
                closeOnEsc: false,
                closeOnClickOutside: false,
            };

            swal(swalObj).then((resp) => {
                callback(resp);
            }).catch(swal.noop);
        }

        function infoMsg(type, title, msg = '', timer = null, callback = null) {

            let swalObj = {
                title: title,
                icon: type ?? 'info',
                // buttons: false,
                closeOnEsc: false,
                closeOnClickOutside: false,
                timer: timer,
                content: {
                    element: "div",
                    attributes: {
                        innerHTML:"<p class='text-response'>"+msg ?? "¡Cambios guardados exitosamente!"+"</p>"
                    },
                }
            };

            if(callback) {
                swal(swalObj).then((resp) => {
                    callback(resp);
                }).catch(swal.noop);
            } else {
                swal(swalObj).catch(swal.noop);
            }
        }

        function verDetalles($this) {
            let pedido = $($this).closest("tr").data("item");
            loadMsg();
            console.log(pedido);
            $("#verDetallesCliente").html(pedido.id_cliente + " - " + pedido.nombre_cliente);
            $("#verDetallesTelefono").html(pedido.telefono.trim());
            $("#verDetallesDireccion").html(pedido.direccion.trim());
            $("#verDetallesTipoServicio").html(pedido.tipo_cliente.trim());

            $("#verDetallesServicio").html(pedido.no_pedido);
            $("#verDetallesDireccion2").html(pedido.direccion);
            $("#verDetallesFechaPrometida").html(dateFormatFromDate(pedido.fecha_prometida, '5'));
            $("#verDetallesTipoProducto").html("");
            vrTiposServicios.forEach(element => {
                if(pedido.servicio == element.id) {
                    $("#verDetallesTipoProducto").html(element.nombre);
                }
            });
            if($("#verDetallesTipoProducto").html().trim() == "") {
                $("#verDetallesTipoProducto").html("Desconocido");
            }
            $("#verDetallesEstadoSeguimiento").html(pedido.estado);
            $("#verDetallesObservaciones").html(pedido.observaciones ? pedido.observaciones : 'Sin observaciones');

            let settings = {
                url      : urlGetItemsOpp,
                method   : 'POST',
                data     : JSON.stringify({opp : pedido.no_pedido}),
            }

            setAjax(settings).then((response) => {
                if(response.success) {
                    $('.productosCilindroPedido, .productosEstacionarioPedido').parent().parent().addClass('d-none');
                    $('.productosCilindroPedido tbody, .productosEstacionarioPedido tbody').children("tr").remove();
                    var table = $('.productosCilindroPedido');
                    response.data.forEach(element => {
                        if(element.itemId == deftEstacionarVal) {
                            table = $('.productosEstacionarioPedido');
                        }
                    });
                    table.parent().parent().removeClass('d-none');
                    let total = 0;
                    response.data.forEach(articulo => {
                        articulo.amount = articulo.amount ? parseFloat(articulo.amount) : 0;
                        articulo.taxAmount = articulo.taxAmount ? parseFloat(articulo.taxAmount) : 0;
                        if(table.hasClass('productosCilindroPedido')) {
                            $(".productosCilindroPedido tbody").append(
                                '<tr data-item-id='+articulo.itemId+' class="product-item" data-item=' + "'" + JSON.stringify(articulo) + "'" + '>' +
                                    '<td class="text-center">'+articulo.item+'</td>'+
                                    '<td class="text-center">'+articulo.quantity+'</td>'+
                                    '<td class="text-center">'+articulo.capacidad+' kg</td>'+
                                    '<td class="text-center" data-total='+(articulo.amount+articulo.taxAmount)+'>$'+(articulo.amount+articulo.taxAmount).toFixed(2)+' mxn</td>'+
                                '</tr>'
                            );
                        } else {
                            $(".productosEstacionarioPedido tbody").append(
                                '<tr data-item-id='+articulo.itemId+' class="product-item" data-item=' + "'" + JSON.stringify(articulo) + "'" + '>' +
                                    '<td>'+articulo.item+'</td>'+
                                    '<td class="text-center">'+articulo.quantity+'</td>'+
                                    '<td class="text-center">1</td>'+
                                    '<td class="text-center" data-total='+(articulo.amount+articulo.taxAmount)+'>$'+(articulo.amount+articulo.taxAmount)+' mxn</td>'+
                                '</tr>'
                            );
                        }
                        
                        total = total + (articulo.amount+articulo.taxAmount);
                    });

                    total = total.toFixed(2);
                    table.children('tfoot').find('td.total').data('total', total);
                    table.children('tfoot').find('td.total').text('$'+total+' mxn');            
                }
                $("#formVerDetallesPedidos").modal("show");
                swal.close();
            }).catch((error) => {
                console.log(error);
                swal.close();
            });
            
        }

        function readyInit() {
            let totalServices = 4;
            countServices += 1;
            if(countServices == totalServices) {
                getServicios();
            }
        }

        loadMsg();
        getPlantas();
        getTiposServicios();
        getStatusOportunidad();
        getZonas();
    </script>

</body>

</html>